sudo: required
dist: trusty
language: java
jdk: oraclejdk8
services:
- docker
cache:
  directories:
  - "$HOME/.m2"
before_script:
- docker run --name $RIAK_FLAVOR -d -p 8087:8087 -p 8098:8098 basho/riak-ts
- docker exec $RIAK_FLAVOR riak-admin wait-for-service riak_kv
- tools/devrel/riak-cluster-config "docker exec $RIAK_FLAVOR riak-admin" 8098 false
  false
script:
- if [[ $RIAK_FLAVOR == "riak-kv" ]]; then mvn -Pitest,default -Dcom.basho.riak.yokozuna=false verify; fi
- if [[ $RIAK_FLAVOR == "riak-ts" ]]; then mvn -Pitest,default -Dcom.basho.riak.yokozuna=false -Dcom.basho.riak.timeseries=true verify; fi
after_script:
- docker rm -f $RIAK_FLAVOR
env:
  matrix:
  - RIAK_FLAVOR=riak-ts
  - RIAK_FLAVOR=riak-kv
  global:
  - RIAK_HOSTS=localhost:8087
notifications:
  slack:
    secure: lCGUVnffHyrS1rpOlencvFdID7pVF2leOvbmxAKf/svkjJDLd0BWa9SgLjUDtAQ7vCa8B03rO0fWmlyynDJBQmudjytm+h8BVgAFJNm0SQOAm4ALNsWmixo4XoXhPl3rl3VmXRrx/bvLI8nA4ZIARak6RXoOXqHnl8KmkNhhxw8=

before_install:
  - wget https://github.com/basho/riak-java-client/archive/c1eba921bdad7970eba09cd563e1ef6c9a11272e.zip
  - unzip c1eba921bdad7970eba09cd563e1ef6c9a11272e.zip
  - cp -rT riak-java-client-c1eba921bdad7970eba09cd563e1ef6c9a11272e ./
  - rm -r riak-java-client-c1eba921bdad7970eba09cd563e1ef6c9a11272e
  - rm c1eba921bdad7970eba09cd563e1ef6c9a11272e.zip
